<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/hudi-bigtop.md at 2023-04-23
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20230423" />
    <meta http-equiv="Content-Language" content="en" />
    <title>hudi-bigtop-site &#x2013; 如何使用bigtop打包hudi的rpm包</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="https://hudi.apache.org/" id="bannerLeft"><img src="https://hudi.apache.org/assets/images/hudi.png"  alt="hudi-bigtop-site"/></a></div>
        <div class="pull-right"><a href="https://bigtop.apache.org/" id="bannerRight"><img src="https://bigtop.apache.org/images/bigtop-logo.png"  alt=""/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-04-23<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://bigtop.apache.org/" class="externalLink" title="bigtop">bigtop</a></li>
      <li class="pull-right"><a href="https://hudi.apache.org/" class="externalLink" title="hudi">hudi</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Hudi Bigtop Build Doc</li>
    <li class="active"><a href="#"><span class="none"></span>Bigtop Build Hudi Rpms</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>&#x5982;&#x4f55;&#x4f7f;&#x7528;bigtop&#x6253;&#x5305;hudi&#x7684;rpm&#x5305;</h1>
<p>&#x73af;&#x5883;&#xff1a; rockylinux 8.7</p>
<div class="section">
<h2><a name="a.E5.AE.89.E8.A3.85.E5.BF.85.E5.A4.87.E7.9A.84.E8.BD.AF.E4.BB.B6"></a>&#x5b89;&#x88c5;&#x5fc5;&#x5907;&#x7684;&#x8f6f;&#x4ef6;</h2>

<div>
<div>
<pre class="source">yum install -y git yum-utils ruby java-1.8.0-openjdk-devel zip unzip rpm-build

# &#x4f7f;&#x7528;sdkman&#x7ba1;&#x7406;&#x5f00;&#x53d1;&#x65f6;&#x4f7f;&#x7528;&#x7684;sdk&#x5de5;&#x5177;
curl -s &quot;https://get.sdkman.io&quot; | bash
source &quot;$HOME/.sdkman/bin/sdkman-init.sh&quot;
sdk version
sdk install maven
</pre></div></div>
</div>
<div class="section">
<h2><a name="a.E4.B8.8B.E8.BD.BDbigtop.E4.BB.A3.E7.A0.81"></a>&#x4e0b;&#x8f7d;bigtop&#x4ee3;&#x7801;</h2>

<div>
<div>
<pre class="source">git clone https://github.com/apache/bigtop.git
</pre></div></div>
</div>
<div class="section">
<h2><a name="a.E4.BF.AE.E6.94.B9bigtop.bom.E6.96.87.E4.BB.B6"></a>&#x4fee;&#x6539;bigtop.bom&#x6587;&#x4ef6;</h2>
<p>&#x4fee;&#x6539;bigtop&#x7684;bigtop.bom&#x6587;&#x4ef6;&#xff0c;&#x6dfb;&#x52a0;hudi&#x7684;&#x57fa;&#x672c;&#x4fe1;&#x606f;</p>

<div>
<div>
<pre class="source">    'hudi' {
      name    = 'hudi'
      pkg     = name
      rpm_pkg_suffix = &quot;_&quot; + bigtop.base_version.replace(&quot;.&quot;, &quot;_&quot;)
      version {
        base  = '0.13.0'
        pkg   = base
        release = 1
      }
      tarball {
        source      = &quot;hudi-${version.base}.src.tgz&quot;
        destination = &quot;hudi-${version.base}-src.tar.gz&quot;
      }
      url {
        download_path = &quot;/hudi/${version.base}&quot;
        site          = &quot;${apache.APACHE_MIRROR}/${download_path}&quot;
        archive       = &quot;${apache.APACHE_ARCHIVE}/${download_path}&quot;
      }
    }
</pre></div></div>
</div>
<div class="section">
<h2><a name="a.E6.B7.BB.E5.8A.A0hudi.E6.9E.84.E5.BB.BA.E8.84.9A.E6.9C.AC"></a>&#x6dfb;&#x52a0;hudi&#x6784;&#x5efa;&#x811a;&#x672c;</h2>
<p>hudi&#x7684;&#x6784;&#x5efa;&#x811a;&#x672c;&#x5982;&#x4e0b;&#x6240;&#x793a;</p>

<div>
<div>
<pre class="source">mvn clean package -DskipTests
</pre></div></div>

<p>&#x5728;bigtop-packages/src/common&#x76ee;&#x5f55;&#x4e0b;&#x65b0;&#x589e;hudi&#x76ee;&#x5f55;&#xff0c;&#x65b0;&#x589e;do-component-build</p>

<div>
<div>
<pre class="source">cd bigtop-packages/src/common
mkdir hudi
cd hudi
cat &gt; ./do-component-build &lt;&lt; __EOT__
set -xe

. `dirname $0`/bigtop.bom

mvn clean package -DskipTests
__EOT__
</pre></div></div>
</div>
<div class="section">
<h2><a name="a.E6.96.B0.E5.A2.9Ehudi.E7.9A.84spec.E6.96.87.E4.BB.B6"></a>&#x65b0;&#x589e;hudi&#x7684;spec&#x6587;&#x4ef6;</h2>

<div>
<div>
<pre class="source">%define hudi_name hudi
%define hudi_pkg_name hudi%{pkg_name_suffix}
%define hadoop_pkg_name hadoop%{pkg_name_suffix}
%define __os_install_post %{nil}

%define usr_lib_hudi %{parent_dir}/usr/lib/%{hudi_name}
%define etc_hudi %{parent_dir}/etc/%{hudi_name}

Name: %{hudi_pkg_name}
Version: %{hudi_version}
Release: %{hudi_release}
Summary:Apache Hudi is the next generation streaming data lake platform.
URL: http://hudi.apache.org
Group: Development/Libraries
Buildroot: %{_topdir}/INSTALL/%{name}-%{version}
License: Apache License v2.0
Source0: %{hudi_name}-%{hudi_base_version}-src.tar.gz
Source1: do-component-build
#BIGTOP_PATCH_FILES
BuildArch: noarch
Requires: %{hadoop_pkg_name} %{hadoop_pkg_name}-hdfs %{hadoop_pkg_name}-yarn %{hadoop_pkg_name}-mapreduce

%description
Apache Hudi is the next generation streaming data lake platform. 
Apache Hudi brings core warehouse and database functionality directly 
to a data lake. Hudi provides tables, transactions, efficient upserts and deletes,
advanced indexes, streaming ingestion services, data clustering/compaction 
optimizations, and concurrency all while keeping your data in open source file 
formats.

%define package_macro() \
%package %1 \
Summary: apache hudi %1 bundle \
Group: System/Daemons \
%description %1 \
apache hudi %1 bundle 

%package_macro spark
%package_macro flink
%package_macro datahub-sync
%package_macro timeline-server
%package_macro kafka-connect
%package_macro trino
%package_macro utilities
%package_macro utilities-slim
%package_macro aws
%package_macro gcp
%package_macro hadoop-mr
%package_macro presto
%package_macro cli
%package_macro hive-sync

%prep
%setup -q -n %{hudi_name}-%{hudi_base_version}

%build
bash %{SOURCE1}

%install
%__rm -rf $RPM_BUILD_ROOT

LIB_DIR=${LIB_DIR:-/usr/lib/hudi}
install -d -m 0755 $RPM_BUILD_ROOT/$LIB_DIR/lib

for comp in spark utilities utilities-slim cli        
do 
cp ./packaging/hudi-${comp}-bundle/target/hudi-${comp}-bundle_2.11-%{hudi_version}.jar $RPM_BUILD_ROOT/$LIB_DIR/lib
done

for comp in datahub-sync timeline-server kafka-connect trino gcp \
            aws hadoop-mr presto hive-sync          
do 
cp ./packaging/hudi-${comp}-bundle/target/hudi-${comp}-bundle-%{hudi_version}.jar $RPM_BUILD_ROOT/$LIB_DIR/lib
done

cp ./packaging/hudi-flink-bundle/target/hudi-flink1.16-bundle-%{hudi_version}.jar $RPM_BUILD_ROOT/$LIB_DIR/lib

%pre

# Manage configuration symlink
%post

%preun


#######################
#### FILES SECTION ####
#######################
# Scala Jar file management RPMs
%define jar_scala_macro() \
%files %1 \
%defattr(-,root,root) \
%{usr_lib_hudi}/lib/hudi-%1-bundle_2.11-%{hudi_version}.jar

# Java Jar file management RPMs
%define jar_macro() \
%files %1 \
%defattr(-,root,root) \
%{usr_lib_hudi}/lib/hudi-%1-bundle-%{hudi_version}.jar

%jar_scala_macro spark
%jar_macro datahub-sync
%jar_macro timeline-server
%jar_macro kafka-connect
%jar_macro trino
%jar_scala_macro utilities
%jar_scala_macro utilities-slim
%jar_macro aws
%jar_macro gcp
%jar_macro hadoop-mr
%jar_macro presto
%jar_scala_macro cli
%jar_macro hive-sync

%files flink
%defattr(-,root,root) 
%{usr_lib_hudi}/lib/hudi-flink1.16-bundle-%{hudi_version}.jar
</pre></div></div>
</div>
<div class="section">
<h2><a name="a.E6.9E.84.E5.BB.BAhudi_rpm.E5.8C.85"></a>&#x6784;&#x5efa;hudi rpm&#x5305;</h2>
<p>&#x4e0a;&#x9762;&#x6b65;&#x9aa4;&#x5b8c;&#x6210;&#x4e4b;&#x540e;&#x5c31;&#x53ef;&#x4ee5;&#x8fdb;&#x884c;&#x6784;&#x5efa;</p>

<div>
<div>
<pre class="source">./gradlew allclean hudi-rpm
</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2001&#x2013;2023.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
